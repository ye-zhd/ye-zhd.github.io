<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>talk</title>
      <link href="/posts/undefined.html"/>
      <url>/posts/undefined.html</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h1><h2 id="crontab-配置ansible-注意事项"><a href="#crontab-配置ansible-注意事项" class="headerlink" title="crontab 配置ansible 注意事项"></a>crontab 配置ansible 注意事项</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#需要配置 PYTHONPATH</span><span class="token comment"># import os </span><span class="token comment"># print os.sys.path 查看pythonpath</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">PYTHONPATH</span><span class="token operator">=</span>/usr/lib/python2.6/site-packagesansible-playbook /tmp/test.yaml -s <span class="token operator">>></span>/tmp/ansible-cron.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-cron"><a href="#ansible-cron" class="headerlink" title="ansible cron"></a>ansible cron</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#ansible 添加 定时任务</span>ansible <span class="token number">10.252</span>.10.101 -m <span class="token function">cron</span> -a <span class="token string">"minute=*/10 hour=* day=* month=*   weekday=* name='test' job=<span class="token entity" title="\&quot;">\"</span>sh /data/etl/mv_data.sh<span class="token entity" title="\&quot;">\"</span>"</span> -S -R root<span class="token comment">#ansible 注释任务</span>ansible <span class="token number">10.252</span>.10.101 -m <span class="token function">cron</span> -a <span class="token string">"name='test' job=<span class="token entity" title="\&quot;">\"</span>sh /data/etl/mv_data.sh<span class="token entity" title="\&quot;">\"</span> disabled=yes"</span> -S -R root<span class="token comment">#ansible 删除任务</span>ansible <span class="token number">10.252</span>.10.101 -m <span class="token function">cron</span> -a <span class="token string">"name=test state=absent"</span><span class="token comment">#####sed 查找替换 定时任务时间周期</span><span class="token function">sed</span> -i <span class="token string">'/mv_data/s/30/5/g'</span> /var/spool/cron/root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-cmdb"><a href="#ansible-cmdb" class="headerlink" title="ansible-cmdb"></a>ansible-cmdb</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> https://github.com/fboender/ansible-cmdb/releases/download/1.30/ansible-cmdb-1.30.tar.gz<span class="token function">tar</span> -xvf ansible-cmdb-1.30.tar.gz -C /usr/share/ansible/plugins<span class="token builtin class-name">cd</span> /usr/share/ansible/plugins/ansible-cmdb-1.30/ <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment">#生成所有主机的facts信息</span>ansible all -m setup --tree /usr/local/out<span class="token comment">#生成的facts信息生成web页面</span>ansible-cmdb /usr/local/out/ <span class="token operator">></span> overview.html<span class="token comment">#以资产列表形式统计出ansible主机信息</span>ansible-cmdb -t txt_table --columns name,os,ip,mem,cpus /usr/local/out/<span class="token comment">#more命令</span><span class="token function">more</span> */*/*.txt <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">'602.E602E22'</span><span class="token comment">#批量改名字</span><span class="token function">rename</span> .ok .xml *.ok<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible playbook"></a>ansible playbook</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@ansible PlayBook<span class="token punctuation">]</span><span class="token comment"># ansible-playbook -h</span><span class="token comment">#ansible-playbook常用选项：</span>--check  or -C    <span class="token comment">#只检测可能会发生的改变，但不真正执行操作</span>--list-hosts      <span class="token comment">#列出运行任务的主机</span>--list-tags       <span class="token comment">#列出playbook文件中定义所有的tags</span>--list-tasks      <span class="token comment">#列出playbook文件中定义的所以任务集</span>--limit           <span class="token comment">#主机列表 只针对主机列表中的某个主机或者某个组执行</span>-f                <span class="token comment">#指定并发数，默认为5个</span>-t                <span class="token comment">#指定tags运行，运行某一个或者多个tags。（前提playbook中有定义tags）</span>-v                <span class="token comment">#显示过程  -vv  -vvv更详细</span>root权限执行：  ansible-playbook  -S -R root test.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>批量拷贝文件到本地</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">##批量拷贝文件到本地</span>- hosts: cxchuzhi:gmqchuzhi  tasks:    - name: result_shazhupan      find:        paths: /tmp/        patterns: <span class="token string">"*xml"</span>        recurse: no      register: file_2_fetch    - name: data_shazhupan      fetch:        src: <span class="token string">"&#123;&#123; item.path &#125;&#125;"</span>        dest: /tmp/linux_check/        flat: <span class="token function">yes</span>      with_items: <span class="token string">"&#123;&#123; file_2_fetch.files &#125;&#125;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>添加修改用户yaml</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">##添加用户并sudo</span>- hosts: <span class="token builtin class-name">test</span>  vars:    user: hdfs    password: <span class="token string">'eversec123098'</span>  remote_user: root  tasks:  - name: Add user <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    user: <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token assign-left variable">comment</span><span class="token operator">=</span><span class="token string">"ambari user"</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">'eversec123098'</span>  - name: Config /etc/sudoers    lineinfile: <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/sudoers <span class="token assign-left variable">state</span><span class="token operator">=</span>present  <span class="token assign-left variable">line</span><span class="token operator">=</span><span class="token string">'&#123;&#123;item&#125;&#125;'</span>    with_items:      - <span class="token string">"&#123;&#123; user&#125;&#125; ALL=(ALL) NOPASSWD: ALL"</span>      - <span class="token string">"Defaults: &#123;&#123;user&#125;&#125;  !requiretty"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">- hosts: px  gather_facts: <span class="token boolean">false</span>  tasks:  - name: Change password    user: <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> chpass <span class="token operator">|</span> password_hash<span class="token punctuation">(</span><span class="token string">'sha512'</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  <span class="token assign-left variable">update_password</span><span class="token operator">=</span>always  - name: Config /etc/sudoers    lineinfile: <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/sudoers <span class="token assign-left variable">state</span><span class="token operator">=</span>present  <span class="token assign-left variable">line</span><span class="token operator">=</span><span class="token string">'&#123;&#123;item&#125;&#125;'</span>    with_items:      - <span class="token string">"&#123;&#123; name &#125;&#125; ALL=(ALL) NOPASSWD: ALL"</span>      - <span class="token string">"Defaults: &#123;&#123;name&#125;&#125;  !requiretty修改或者添加用户：ansible-playbook  -S -R root useradd-input.yaml -e "</span>name<span class="token operator">=</span>test <span class="token assign-left variable">chpass</span><span class="token operator">=</span><span class="token number">123456</span>"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务启动：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>                       <span class="token comment">#固定格式</span><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> 10.20.3.107      <span class="token comment">#定义需要执行主机</span>  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root       <span class="token comment">#远程用户</span>  <span class="token key atrule">vars</span><span class="token punctuation">:</span>                   <span class="token comment">#定义变量</span>    <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">8088</span>       <span class="token comment">#变量</span>  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>                             <span class="token comment">#定义一个任务的开始</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start crond      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=crond state=started<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux,ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
