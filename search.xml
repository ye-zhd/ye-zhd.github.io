<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>frp内网穿透搭建</title>
      <link href="/posts/4.html"/>
      <url>/posts/4.html</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="frp内网穿透搭建"><a href="#frp内网穿透搭建" class="headerlink" title="frp内网穿透搭建"></a>frp内网穿透搭建</h1><h2 id="1、前提条件"><a href="#1、前提条件" class="headerlink" title="1、前提条件"></a>1、前提条件</h2><p>1.有公网IP的服务器一台（阿里云，这里用的宽带公网ip）</p><p>2.访问目标设备，即你需要外网访问到的设备（比如我的笔记本，我需要外网访问到我的localhost运行的项目）</p><h2 id="2、软件下载"><a href="#2、软件下载" class="headerlink" title="2、软件下载"></a>2、软件下载</h2><p>更具内核版本下载对应的软件包：<a href="https://github.com/fatedier/frp/releases/">https://github.com/fatedier/frp/releases/</a></p><h2 id="3、软件安装"><a href="#3、软件安装" class="headerlink" title="3、软件安装"></a>3、软件安装</h2><h3 id="1、服务端安装"><a href="#1、服务端安装" class="headerlink" title="1、服务端安装"></a>1、服务端安装</h3><blockquote><p>解压包tar -zxvf frp_0.46.1_linux_amd64.tar.gz</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">####frps开头的是值服务端需要的，frpc开头的是指客户端需要的[root@fjbsc-01 frp_0.46.1_linux_amd64]# ls -lrt总用量 27856-rwxr-xr-x 1 1001 123 12660736 1月  10 10:34 frpc -rwxr-xr-x 1 1001 123 15822848 1月  10 10:34 frps-rw-r--r-- 1 1001 123    11358 1月  10 10:39 LICENSE-rw-r--r-- 1 1001 123       26 1月  10 10:39 frps.ini-rw-r--r-- 1 1001 123     5907 1月  10 10:39 frps_full.ini-rw-r--r-- 1 1001 123      126 1月  10 10:39 frpc.ini-rw-r--r-- 1 1001 123    11238 1月  10 10:39 frpc_full.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>配置frps.ini</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@fjbsc-01 frp_0.46.1_linux_amd64]# cat frps.ini   [common]#bind_port客户端和服务端连接的端口，这个端口号我们之后在配置客户端的时候要用到bind_port &#x3D; 7000#dashboard_port 服务端仪表板的端口，若使用7500端口，在配置完成服务启动后可以通过浏览器访问 x.x.x.x:7500dashboard_port &#x3D; 7500#token 用于客户端和服务端连接的口令token &#x3D; 12345678#dashboard_user与dashboard_pwd表示打开仪表板页面登录的用户名和密码dashboard_user &#x3D; admindashboard_pwd &#x3D; admin#vhost_http_port和vhost_https_port用于反向代理HTTP主机时使用,不涉及vhost_http_port &#x3D; 10080vhost_https_port &#x3D; 10443<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>启动</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nohup .&#x2F;frps -c frps.ini &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2、客户端安装"><a href="#2、客户端安装" class="headerlink" title="2、客户端安装"></a>2、客户端安装</h3><blockquote><p>我是在windows环境下配置，修改frpc.ini如下</p></blockquote><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">[common]<span class="token attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token attr-value">112.51.25.139</span><span class="token attr-name">authentication_method</span> <span class="token punctuation">=</span> <span class="token attr-value">token</span><span class="token attr-name">token</span><span class="token punctuation">=</span><span class="token attr-value">12345678</span><span class="token attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token attr-value">7000</span>[tcp]<span class="token attr-name">type</span> <span class="token punctuation">=</span> <span class="token attr-value">tcp</span><span class="token comment"># 本地web应用的ip和端口</span><span class="token attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token attr-value">10.252.10.175</span><span class="token attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token attr-value">443</span><span class="token comment"># 公网服务器提供给外网访问的端口</span><span class="token attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token attr-value">53818</span><span class="token attr-name">privilege_mode</span> <span class="token punctuation">=</span> <span class="token attr-value">true </span><span class="token attr-name">authentication_timeout</span> <span class="token punctuation">=</span> <span class="token attr-value">0 </span><span class="token attr-name">use_encryption</span> <span class="token punctuation">=</span> <span class="token attr-value">true </span><span class="token attr-name">use_gzip</span> <span class="token punctuation">=</span> <span class="token attr-value">true</span>[tcp2]<span class="token attr-name">type</span> <span class="token punctuation">=</span> <span class="token attr-value">tcp</span><span class="token comment"># 本地web应用的ip和端口</span><span class="token attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token attr-value">10.252.10.175</span><span class="token attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token attr-value">63389</span><span class="token comment"># 公网服务器提供给外网访问的端口</span><span class="token attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token attr-value">63389</span>[tcp3]<span class="token attr-name">type</span> <span class="token punctuation">=</span> <span class="token attr-value">tcp</span><span class="token comment"># 本地web应用的ip和端口</span><span class="token attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token attr-value">10.252.10.175</span><span class="token attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token attr-value">60022</span><span class="token comment"># 公网服务器提供给外网访问的端口</span><span class="token attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token attr-value">60022</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>启动命令 cmd窗口 ：frpc.exe -c frpc.ini</p></blockquote><p>会遇到的问题：</p><p>问题一：</p><pre class="line-numbers language-none"><code class="language-none">客户端的时钟不能和服务器端时钟相差太大！否则会出现认证超时的错误:authorization timeout这个超时时间可以在配置文件中通过 authentication_timeout 这个参数来修改，单位为秒，默认值为 900，即 15 分钟。如果修改为 0，则 frps 将不对身份验证报文的时间戳进行超时校验<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>问题二：</p><p>由于是宽带的公网ip映射的内网地址，防火墙nat策略需要开放端口:<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34997268/1675216703631-b8bd56cd-f785-49cb-bfbc-466ac84f2f94.png#averageHue=%23dfe5e6&clientId=ub6ceff03-3003-4&from=paste&height=409&id=ubd0f32e0&name=image.png&originHeight=613&originWidth=1424&originalType=binary&ratio=1&rotation=0&showTitle=false&size=742854&status=done&style=none&taskId=ud4b40eb9-b2f8-49ab-9501-68dbc65070b&title=&width=949.3333333333334" alt="image.png"></p><h3 id="3、连接与带宽查看"><a href="#3、连接与带宽查看" class="headerlink" title="3、连接与带宽查看"></a>3、连接与带宽查看</h3><blockquote><p>sever端的页面查看带宽占用：</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34997268/1675216721652-35f4204b-9a8e-4c9a-ab11-2324d3550a32.png#averageHue=%23e1dbc8&clientId=ub6ceff03-3003-4&from=paste&height=340&id=u3b6ddffb&name=image.png&originHeight=510&originWidth=1432&originalType=binary&ratio=1&rotation=0&showTitle=false&size=114187&status=done&style=none&taskId=u3975b8eb-9425-42f4-bb21-2ae87da20c0&title=&width=954.6666666666666" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>故事</title>
      <link href="/posts/3.html"/>
      <url>/posts/3.html</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h2 id="流浪猫与小女孩"><a href="#流浪猫与小女孩" class="headerlink" title="流浪猫与小女孩"></a><center>流浪猫与小女孩</center></h2><p>&emsp;&emsp;一个小镇上，小女孩 像往常一样的放学，走在回家的路上，手上拿着好吃的零食。这时候小流浪猫三花，闻到了味道，跟着小女孩一路，撒着娇要吃的，小女孩觉得小猫可怜可爱，分了自己的零食给它吃，小猫喵喵的叫着表示感谢，开心的吃着。第二天，小猫看到小女孩像认出了她一样，直接跑了上去撒娇要吃的，平时就喜欢小动物的小女孩遇到这样也很开心，把自己一大半的零食分给了小猫。周五放学，小猫跟着来到了小女孩家附近，平时怕人的小猫知道不能随便进别人家，在门口待着，小女孩拿出自己平时珍藏的好吃的鱼干零食喂它。这几天喂着，小猫就开始有点粘着小女孩，经常从自己待着的废品站跑出来到小女孩家里，小女孩本身也挺喜欢猫的，但家里人从来不让养宠物。就这样过了几周后，一直流浪到处找吃的小猫有了家的感觉，变得更加粘着小女孩了，因为知道找她就有东西吃。但小猫很活泼调皮，爪子也很长。</p><p>&emsp;&emsp;小女孩平时要上学，也有自己的作业要做。后面时间长了，小猫变得不那么怕生，调皮捣乱的经常跑进房间里，一会儿就又跑去其他地方玩了，小女孩总是笑笑的看着它，时常停下自己做作业的笔与小猫玩闹。小猫知道找小女孩就有吃的，还可以陪着一起玩，，还不小心抓破了小女孩的手，小女孩很善良，没有责备它，也不太在意，依然经常拿鱼干零食与每天剩下的饭喂它。</p><p>&emsp;&emsp;小女孩要期中考试了，自然作业变多了，得到好处的小猫后来有点放纵了，只要肚子饿就开始叫着要吃的。然而小女孩要复习写作业，要准备自己的期中考试，温柔的小女孩依然继续喂着小猫，但没有小鱼零食了，就只有些平时故意留着的剩饭，作业变多了，小女孩没时间去买零食了。现在小女孩觉得它有点调皮了，没有了想养它的想法了，还是继续的喂着小猫。小猫只要有的吃就行，但它觉得奇怪为什么不陪我玩了呢，开始跑到房间去找小女孩。小女孩看到小猫进来找她，还放下手中的笔，抱着小猫玩了一会。再几次，小猫一直跑来跑去的，小女孩觉得有点不耐烦了，常常敷衍的摸了摸小猫，就把小猫抱出门外，让它自己去玩。有一次小猫跳到桌子上，弄乱了作业，小女孩生气了，这次小女孩跺着脚，把小猫吓了出去。小猫也感觉到了小女孩的生气，隔天，小猫怯怯的在门口叫着，今天小女孩忘记留点东西给小猫了，就走到门口抱着小猫玩了一会。小猫习惯了在这等吃的，就继续等着，后面实在饿了，自己去找吃的了。</p><p>&emsp;&emsp;小猫还是像往日一样又来了，小女孩马上就要考试了，也没有特意去留东西给它吃。小猫一直喵喵的叫着，小女孩有点静不下心来写作业觉得烦。小猫也察觉到自己以前太调皮了，现在小猫自己找吃的，就找女孩玩会，但小女孩不想理它了，小猫没看到小女孩出来，自己跑进房间去了，小女孩生气的把它抱了出去，说别来找我了，小猫感觉到自己做错了，隔天还是来找小女孩，小女孩又把它赶了出去。这个时候小猫有点不知道怎么办，但小猫习惯了有小女孩的日子，依旧常常放学路上跟着小女孩，去到小女孩家附近，小女孩讨厌它了，赶它走，小猫只能的远远的喵喵叫着，回到了最初的自己一只猫呆着的时候,小猫还想着小女孩的零食鱼干，想着和她一起玩，只是回不到从前了。</p><p align="right">By: 发神经的叶落落</p>]]></content>
      
      
      <categories>
          
          <category> 心情 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> think </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ansible学习使用</title>
      <link href="/posts/2.html"/>
      <url>/posts/2.html</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h1><h2 id="crontab-配置ansible-注意事项"><a href="#crontab-配置ansible-注意事项" class="headerlink" title="crontab 配置ansible 注意事项"></a>crontab 配置ansible 注意事项</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#需要配置 PYTHONPATH# import os # print os.sys.path 查看pythonpathexport PYTHONPATH&#x3D;&#x2F;usr&#x2F;lib&#x2F;python2.6&#x2F;site-packagesansible-playbook &#x2F;tmp&#x2F;test.yaml -s &gt;&gt;&#x2F;tmp&#x2F;ansible-cron.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-wait-for"><a href="#ansible-wait-for" class="headerlink" title="ansible wait_for"></a>ansible wait_for</h2><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">ansible   dpi  -m wait_for -a &quot;host&#x3D;134.132.245.2 port&#x3D;22 delay&#x3D;2 timeout&#x3D;5&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ansible-cron"><a href="#ansible-cron" class="headerlink" title="ansible cron"></a>ansible cron</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#ansible 添加 定时任务ansible 10.252.10.101 -m cron -a &quot;minute&#x3D;*&#x2F;10 hour&#x3D;* day&#x3D;* month&#x3D;*   weekday&#x3D;* name&#x3D;&#39;test&#39; job&#x3D;\&quot;sh &#x2F;data&#x2F;etl&#x2F;mv_data.sh\&quot;&quot; -S -R root#ansible 注释任务ansible 10.252.10.101 -m cron -a &quot;name&#x3D;&#39;test&#39; job&#x3D;\&quot;sh &#x2F;data&#x2F;etl&#x2F;mv_data.sh\&quot; disabled&#x3D;yes&quot; -S -R root#ansible 删除任务ansible 10.252.10.101 -m cron -a &quot;name&#x3D;test state&#x3D;absent&quot;#####sed 查找替换 定时任务时间周期sed -i &#39;&#x2F;mv_data&#x2F;s&#x2F;30&#x2F;5&#x2F;g&#39; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-cmdb"><a href="#ansible-cmdb" class="headerlink" title="ansible-cmdb"></a>ansible-cmdb</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">wget https:&#x2F;&#x2F;github.com&#x2F;fboender&#x2F;ansible-cmdb&#x2F;releases&#x2F;download&#x2F;1.30&#x2F;ansible-cmdb-1.30.tar.gztar -xvf ansible-cmdb-1.30.tar.gz -C &#x2F;usr&#x2F;share&#x2F;ansible&#x2F;pluginscd &#x2F;usr&#x2F;share&#x2F;ansible&#x2F;plugins&#x2F;ansible-cmdb-1.30&#x2F; &amp;&amp; make install#生成所有主机的facts信息ansible all -m setup --tree &#x2F;usr&#x2F;local&#x2F;out#生成的facts信息生成web页面ansible-cmdb &#x2F;usr&#x2F;local&#x2F;out&#x2F; &gt; overview.html#以资产列表形式统计出ansible主机信息ansible-cmdb -t txt_table --columns name,os,ip,mem,cpus &#x2F;usr&#x2F;local&#x2F;out&#x2F;#more命令more *&#x2F;*&#x2F;*.txt |grep &#39;602.E602E22&#39;#批量改名字rename .ok .xml *.ok<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible playbook"></a>ansible playbook</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@ansible PlayBook]# ansible-playbook -h#ansible-playbook常用选项：--check  or -C    #只检测可能会发生的改变，但不真正执行操作--list-hosts      #列出运行任务的主机--list-tags       #列出playbook文件中定义所有的tags--list-tasks      #列出playbook文件中定义的所以任务集--limit           #主机列表 只针对主机列表中的某个主机或者某个组执行-f                #指定并发数，默认为5个-t                #指定tags运行，运行某一个或者多个tags。（前提playbook中有定义tags）-v                #显示过程  -vv  -vvv更详细root权限执行：  ansible-playbook  -S -R root test.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><h4 id="批量拷贝文件到本地"><a href="#批量拷贝文件到本地" class="headerlink" title="批量拷贝文件到本地"></a>批量拷贝文件到本地</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">##批量拷贝文件到本地- hosts: cxchuzhi:gmqchuzhi  tasks:    - name: result_shazhupan      find:        paths: &#x2F;tmp&#x2F;        patterns: &quot;*xml&quot;        recurse: no      register: file_2_fetch    - name: data_shazhupan      fetch:        src: &quot;&#123;&#123; item.path &#125;&#125;&quot;        dest: &#x2F;tmp&#x2F;linux_check&#x2F;        flat: yes      with_items: &quot;&#123;&#123; file_2_fetch.files &#125;&#125;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="添加修改用户yaml"><a href="#添加修改用户yaml" class="headerlink" title="添加修改用户yaml"></a>添加修改用户yaml</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">##添加用户并sudo- hosts: test  vars:    user: hdfs    password: &#39;eversec123098&#39;  remote_user: root  tasks:  - name: Add user &#123;&#123; user &#125;&#125;    user: name&#x3D;&#123;&#123;user&#125;&#125; comment&#x3D;&quot;ambari user&quot; password&#x3D;&#123;&#123;password&#125;&#125;  - name: Config &#x2F;etc&#x2F;sudoers    lineinfile: dest&#x3D;&#x2F;etc&#x2F;sudoers state&#x3D;present  line&#x3D;&#39;&#123;&#123;item&#125;&#125;&#39;    with_items:      - &quot;&#123;&#123; user&#125;&#125; ALL&#x3D;(ALL) NOPASSWD: ALL&quot;      - &quot;Defaults: &#123;&#123;user&#125;&#125;  !requiretty&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">- hosts: px  gather_facts: false  tasks:  - name: Change password    user: name&#x3D;&#123;&#123; name &#125;&#125;  password&#x3D;&#123;&#123; chpass | password_hash(&#39;sha512&#39;) &#125;&#125;  update_password&#x3D;always  - name: Config &#x2F;etc&#x2F;sudoers    lineinfile: dest&#x3D;&#x2F;etc&#x2F;sudoers state&#x3D;present  line&#x3D;&#39;&#123;&#123;item&#125;&#125;&#39;    with_items:      - &quot;&#123;&#123; name &#125;&#125; ALL&#x3D;(ALL) NOPASSWD: ALL&quot;      - &quot;Defaults: &#123;&#123;name&#125;&#125;  !requiretty修改或者添加用户：ansible-playbook  -S -R root useradd-input.yaml -e &quot;name&#x3D;test chpass&#x3D;123456&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="服务启动："><a href="#服务启动：" class="headerlink" title="服务启动："></a>服务启动：</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>                       <span class="token comment">#固定格式</span><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> 10.20.3.107      <span class="token comment">#定义需要执行主机</span>  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root       <span class="token comment">#远程用户</span>  <span class="token key atrule">vars</span><span class="token punctuation">:</span>                   <span class="token comment">#定义变量</span>    <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">8088</span>       <span class="token comment">#变量</span>  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>                             <span class="token comment">#定义一个任务的开始</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start crond      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=crond state=started<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
