<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ansible学习使用</title>
      <link href="/posts/undefined.html"/>
      <url>/posts/undefined.html</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h1><h2 id="crontab-配置ansible-注意事项"><a href="#crontab-配置ansible-注意事项" class="headerlink" title="crontab 配置ansible 注意事项"></a>crontab 配置ansible 注意事项</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#需要配置 PYTHONPATH# import os # print os.sys.path 查看pythonpathexport PYTHONPATH&#x3D;&#x2F;usr&#x2F;lib&#x2F;python2.6&#x2F;site-packagesansible-playbook &#x2F;tmp&#x2F;test.yaml -s &gt;&gt;&#x2F;tmp&#x2F;ansible-cron.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-cron"><a href="#ansible-cron" class="headerlink" title="ansible cron"></a>ansible cron</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#ansible 添加 定时任务ansible 10.252.10.101 -m cron -a &quot;minute&#x3D;*&#x2F;10 hour&#x3D;* day&#x3D;* month&#x3D;*   weekday&#x3D;* name&#x3D;&#39;test&#39; job&#x3D;\&quot;sh &#x2F;data&#x2F;etl&#x2F;mv_data.sh\&quot;&quot; -S -R root#ansible 注释任务ansible 10.252.10.101 -m cron -a &quot;name&#x3D;&#39;test&#39; job&#x3D;\&quot;sh &#x2F;data&#x2F;etl&#x2F;mv_data.sh\&quot; disabled&#x3D;yes&quot; -S -R root#ansible 删除任务ansible 10.252.10.101 -m cron -a &quot;name&#x3D;test state&#x3D;absent&quot;#####sed 查找替换 定时任务时间周期sed -i &#39;&#x2F;mv_data&#x2F;s&#x2F;30&#x2F;5&#x2F;g&#39; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-cmdb"><a href="#ansible-cmdb" class="headerlink" title="ansible-cmdb"></a>ansible-cmdb</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">wget https:&#x2F;&#x2F;github.com&#x2F;fboender&#x2F;ansible-cmdb&#x2F;releases&#x2F;download&#x2F;1.30&#x2F;ansible-cmdb-1.30.tar.gztar -xvf ansible-cmdb-1.30.tar.gz -C &#x2F;usr&#x2F;share&#x2F;ansible&#x2F;pluginscd &#x2F;usr&#x2F;share&#x2F;ansible&#x2F;plugins&#x2F;ansible-cmdb-1.30&#x2F; &amp;&amp; make install#生成所有主机的facts信息ansible all -m setup --tree &#x2F;usr&#x2F;local&#x2F;out#生成的facts信息生成web页面ansible-cmdb &#x2F;usr&#x2F;local&#x2F;out&#x2F; &gt; overview.html#以资产列表形式统计出ansible主机信息ansible-cmdb -t txt_table --columns name,os,ip,mem,cpus &#x2F;usr&#x2F;local&#x2F;out&#x2F;#more命令more *&#x2F;*&#x2F;*.txt |grep &#39;602.E602E22&#39;#批量改名字rename .ok .xml *.ok<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible playbook"></a>ansible playbook</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@ansible PlayBook]# ansible-playbook -h#ansible-playbook常用选项：--check  or -C    #只检测可能会发生的改变，但不真正执行操作--list-hosts      #列出运行任务的主机--list-tags       #列出playbook文件中定义所有的tags--list-tasks      #列出playbook文件中定义的所以任务集--limit           #主机列表 只针对主机列表中的某个主机或者某个组执行-f                #指定并发数，默认为5个-t                #指定tags运行，运行某一个或者多个tags。（前提playbook中有定义tags）-v                #显示过程  -vv  -vvv更详细root权限执行：  ansible-playbook  -S -R root test.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>批量拷贝文件到本地</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">##批量拷贝文件到本地- hosts: cxchuzhi:gmqchuzhi  tasks:    - name: result_shazhupan      find:        paths: &#x2F;tmp&#x2F;        patterns: &quot;*xml&quot;        recurse: no      register: file_2_fetch    - name: data_shazhupan      fetch:        src: &quot;&#123;&#123; item.path &#125;&#125;&quot;        dest: &#x2F;tmp&#x2F;linux_check&#x2F;        flat: yes      with_items: &quot;&#123;&#123; file_2_fetch.files &#125;&#125;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>添加修改用户yaml</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">##添加用户并sudo- hosts: test  vars:    user: hdfs    password: &#39;eversec123098&#39;  remote_user: root  tasks:  - name: Add user &#123;&#123; user &#125;&#125;    user: name&#x3D;&#123;&#123;user&#125;&#125; comment&#x3D;&quot;ambari user&quot; password&#x3D;&#39;eversec123098&#39;  - name: Config &#x2F;etc&#x2F;sudoers    lineinfile: dest&#x3D;&#x2F;etc&#x2F;sudoers state&#x3D;present  line&#x3D;&#39;&#123;&#123;item&#125;&#125;&#39;    with_items:      - &quot;&#123;&#123; user&#125;&#125; ALL&#x3D;(ALL) NOPASSWD: ALL&quot;      - &quot;Defaults: &#123;&#123;user&#125;&#125;  !requiretty&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">- hosts: px  gather_facts: false  tasks:  - name: Change password    user: name&#x3D;&#123;&#123; name &#125;&#125;  password&#x3D;&#123;&#123; chpass | password_hash(&#39;sha512&#39;) &#125;&#125;  update_password&#x3D;always  - name: Config &#x2F;etc&#x2F;sudoers    lineinfile: dest&#x3D;&#x2F;etc&#x2F;sudoers state&#x3D;present  line&#x3D;&#39;&#123;&#123;item&#125;&#125;&#39;    with_items:      - &quot;&#123;&#123; name &#125;&#125; ALL&#x3D;(ALL) NOPASSWD: ALL&quot;      - &quot;Defaults: &#123;&#123;name&#125;&#125;  !requiretty修改或者添加用户：ansible-playbook  -S -R root useradd-input.yaml -e &quot;name&#x3D;test chpass&#x3D;123456&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务启动：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>                       <span class="token comment">#固定格式</span><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> 10.20.3.107      <span class="token comment">#定义需要执行主机</span>  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root       <span class="token comment">#远程用户</span>  <span class="token key atrule">vars</span><span class="token punctuation">:</span>                   <span class="token comment">#定义变量</span>    <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">8088</span>       <span class="token comment">#变量</span>  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>                             <span class="token comment">#定义一个任务的开始</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start crond      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=crond state=started<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
